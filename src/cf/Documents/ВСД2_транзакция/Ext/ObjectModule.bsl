Перем мНеОткрыватьФормуДокумента Экспорт;  //Запрешает открывать форму при вводе на основании, если уже введен ВСД2 Транзакция

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)

	Если (ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.РеализацияТоваровУслуг")) или
		(ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.ПеремещениеТоваров")) Тогда
		// Заполнение шапки
		ДокументОснование = ДанныеЗаполнения.Ссылка;
		//Найдем уже созданный
		ДокВСД = ВСД.НайтиВСД2(ДанныеЗаполнения.Ссылка);
		Если ЗначениеЗаполнено(ДокВСД) Тогда
			Сообщить("Уже создан "+ДокВСД);
			//Д = Новый Структура("Ключ", ДокВСД);
				//ОткрытьФорму("Документ.ВСД2_транзакция.ФормаОбъекта",Д);
			//Форма = ПолучитьФорму("Документ.ВСД2_транзакция.ФормаОбъекта", Д);
			//Форма.Открыть();				
			//Форма = ДокВСД.ПолучитьФорму();
			//Форма.Открыть();
			мНеОткрыватьФормуДокумента = Истина;
			Возврат;
		КонецЕсли;
			
		Организация = ДанныеЗаполнения.Организация;
		Обработка = ВСД.ИнициализацияОбработки(Организация);   // воспользуемся ф-цией ЗаполнитьТЧВСД() или РассчитатьКоличествоДляВСД()
		Если типЗнч(Обработка) = Тип("Строка") тогда
			Сообщить("Не удалось инициализировать обработку Интеграция - документ не будет автоматически заполнен!!!");
			Возврат;
		КонецЕсли;
		Попытка	
			СписокПараметров = Обработка.ПолучитьДанныеДляСозданияВСДТранзакции(ДанныеЗаполнения.Ссылка);
			ПараметрыОрганизации = ВСД.ЗагрузитьПараметры( ДанныеЗаполнения.Организация );
			Обработка.ЗаполнитьШапку_ВСД2_Транзакция(ЭтотОбъект, СписокПараметров, ПараметрыОрганизации);
			Обработка.ЗаполнитьТЧВСД(СписокПараметров.ДокОснование, ЭтотОбъект,,,,СписокПараметров.СтрокиВСД);
		Исключение
			Сообщить("Не удалось заполнить документ");
			Сообщить(ОписаниеОшибки(),СтатусСообщения.Важное);
		КонецПопытки;
		//ЖД Контроль
//		Если Товары.Количество() = 0 Тогда
//			Сообщить("Нет данных (пустая таб часть) для создания ВСД2_Транзакция ",СтатусСообщения.Внимание);
	КонецЕсли;
КонецПроцедуры

мНеОткрыватьФормуДокумента = ложь;
